(function(){angular.module("bethovzartApp",["ngRoute"]);function e(e){e.when("/analyze/:songid",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"})}angular.module("bethovzartApp").config(["$routeProvider",e])})();(function(){console.log("angular soret");angular.module("bethovzartApp").controller("homeCtrl",e);e.$inject=["$scope","songData","songDisplay"];function e(e,n,t){console.log("voy a ejecutar al sorete");var o=this;o.songid=$routeParams.songid;o.pageHeader={title:"Bethovzart",strapline:""};o.sidebar={content:"Este sidebar va a volar"};o.getMidi=function(){o.message="Searching la obra de Beto";n.songMidi(o.songid).success(function(e){o.message="Llego la data";o.songMidi=e}).error(function(e){o.message="Sorry, something se fue al carajo"})};o.getJson=function(){o.message="Searching la obra de Beto pero en json";n.songJson("beto.mid").success(function(e){o.message="Llego la data";t.LoadDisplay(e);o.songJson=e}).error(function(e){o.message="Sorry, something se fue al carajo"})};o.playSong=function(){MIDIjs.play(o.songMidi)};o.stopSong=function(){MIDIjs.stop()};o.showError=function(n){e.$apply(function(){o.message=n.message})};o.zoomIn=function(){alert("In")};o.zoomOut=function(){alert("Out")};o.getMidi();o.getJson()}})();(function(){angular.module("bethovzartApp").service("songData",e);e.$inject=["$http"];function e(e){var n=function(n){console.log("angular es una mierda");return e.get("/api/songs/midi"+lasongIdSong,{responseType:"arraybuffer"})};var t=function(n){return e.get("/api/songs/json"+n)};return{songMidi:n,songJson:t}}})();(function(){angular.module("bethovzartApp").service("songDisplay",h);var e=9;var o=8;var r;var a;var s=0;var l;var c;var g="http://www.w3.org/2000/svg";var u;var v;var f=15;var p;var d;function h(){var e=function(e,n){r=A(e.track);a=r.length;for(t=0;t<a;t++){if(r[t].notes.length>0)s++}c=document.getElementById("svgBox");u=c.clientWidth;v=c.clientHeight;p=v/s-f*(s-1)/2;d=document.getElementById("note");l=z(r);y()};return{LoadDisplay:e}}function y(e){var t=-1;for(n=0;n<r.length;n++){if(r[n].notes.length===0)continue;t++;var o=p/(r[n].maxPitch-r[n].minPitch);var a=u/l;var i=(t+1)*p+t*f;var s=r[n].notes;console.log("verticalShift"+i);for(m=0;m<s.length;m++){var g=s[m];var v=g[0]*a;var h=i-(g[1]-r[n].minPitch)*o;var y=d.cloneNode(true);y.setAttributeNS(null,"cx",v);y.setAttributeNS(null,"cy",h);c.appendChild(y)}}}function b(e){var n=500;var t=0;for(i=0;i<e.length;i++){var o=e[i][1];if(o<n)n=o;if(o>t){t=o}}return[n,t]}function z(e){var n=0;for(i=0;i<e.length;i++){if(e[i].notes.length>0){var t=e[i].notes.length;var o=e[i].notes[t-1];var r=o[0];var a=o[2];var s=r+a;if(s>n){n=s}}}return n}function A(e){var n=[];for(k=0;k<e.length;k++){var t=S(e[k]);n[k]={};n[k].notes=t;var o=b(t);n[k].maxPitch=o[1];n[k].minPitch=o[0]}return n}function S(n){var t=[];var r=0;var a=n.length;for(i=0;i<a;i++){var s=n[i];r+=s.delta;if(s.type===8&&s.subtype===e){var l=s.param1;var c=0;for(j=i+1;j<a;j++){var g=n[j];c+=g.delta;if(g.type===8&&g.subtype===o&&g.param1===l){t.push([r,l,c]);break}}}}return t}})();(function(){angular.module("bethovzartApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();